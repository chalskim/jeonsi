<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>프로필 등록 - 전시</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Reset & Basic Setup --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --background-color: #f4f7f6;
            --card-background: #ffffff;
            --text-color: #333333;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* --- Profile Page Styles --- */
        .profile-container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 80px; /* 하단 고정 버튼 공간 확보 */
        }

        .profile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background-color: var(--card-background);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            color: var(--dark-color);
        }

        .page-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* --- Section Styles --- */
        .section {
            background-color: var(--card-background);
            padding: 20px;
            margin-bottom: 10px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .required {
            color: var(--danger-color);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .form-group .helper-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"],
        .radio-item input[type="radio"] {
            width: auto;
            margin: 0;
        }

        /* --- Profile Picture Upload --- */
        .profile-picture-upload {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar-preview {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #e9ecef;
            border: 3px solid var(--border-color);
        }

        .upload-button {
            padding: 10px 15px;
            background-color: var(--light-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* --- Dynamic List Styles (Experience, Portfolio, Packages, Certificates) --- */
        .dynamic-list {
            list-style: none;
        }

        .list-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .remove-item-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--danger-color);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .add-item-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--light-color);
            border: 1px dashed var(--border-color);
            border-radius: 4px;
            color: var(--primary-color);
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .add-item-btn:hover {
            background-color: #e9ecef;
        }

        /* --- Skill Tag Input (Reused from request form) --- */
        .skill-input-container {
            position: relative;
        }

        .skill-tag-display {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            cursor: text;
            min-height: 48px;
        }

        .skill-tag-display:focus-within {
            border-color: var(--primary-color);
        }

        .tag {
            background-color: var(--light-color);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0;
            font-size: 1rem;
            line-height: 1;
        }

        .skill-input {
            border: none;
            outline: none;
            flex-grow: 1;
            min-width: 120px;
            padding: 4px;
            font-size: 1rem;
        }
        
        .skill-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            list-style: none;
            padding: 0;
            margin: 0;
            display: none;
        }

        .skill-suggestions.active {
            display: block;
        }

        .skill-suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .skill-suggestion-item:hover,
        .skill-suggestion-item.active {
            background-color: var(--light-color);
        }

        /* --- Bottom Action Bar --- */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background-color: var(--card-background);
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .save-button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .save-button:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>

    <div class="profile-container">
        <!-- Profile Header -->
        <header class="profile-header">
            <button class="back-button" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="page-title">프로필 등록</h1>
            <div style="width: 40px;"></div> <!-- Spacer for centering title -->
        </header>

        <form id="profileForm">
            <!-- 1. 기본 정보 -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-user-circle"></i>
                    <span>기본 정보</span>
                </h2>
                
                <div class="form-group">
                    <label>프로필 사진</label>
                    <div class="profile-picture-upload">
                        <img src="https://via.placeholder.com/90x90.png?text=You" alt="프로필 미리보기" class="avatar-preview" id="avatarPreview">
                        <button type="button" class="upload-button" onclick="document.getElementById('avatarInput').click()">
                            <i class="fas fa-camera"></i> 사진 변경
                        </button>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
                    </div>
                </div>

                <div class="form-group">
                    <label for="name">이름 <span class="required">*</span></label>
                    <input type="text" id="name" name="name" placeholder="홍길동" required>
                </div>

                <div class="form-group">
                    <label for="role">역할/직무 <span class="required">*</span></label>
                    <input type="text" id="role" name="role" placeholder="예) 보안 컨설턴트, UI/UX 디자이너" required>
                </div>

                <!-- NEW: 선호 근무형태 -->
                <div class="form-group">
                    <label>선호 근무형태</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref_remote" name="workPreference" value="remote">
                            <label for="pref_remote">원격 근무</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref_offline" name="workPreference" value="offline">
                            <label for="pref_offline">오프라인 근무</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref_hybrid" name="workPreference" value="hybrid">
                            <label for="pref_hybrid">하이브리드</label>
                        </div>
                    </div>
                </div>

                <!-- NEW: 선호 지역 -->
                <div class="form-group">
                    <label for="region">선호 지역</label>
                    <input type="text" id="region" name="region" placeholder="예) 서울, 경기, 판교">
                </div>

                <div class="form-group">
                    <label for="intro">한 줄 소개</label>
                    <input type="text" id="intro" name="intro" placeholder="전문성을 한 줄로 요약해주세요.">
                </div>
            </section>

            <!-- 2. 전문 분야 -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    <span>전문 분야</span>
                </h2>
                
                <div class="form-group">
                    <label for="categoryLarge">대분류 <span class="required">*</span></label>
                    <select id="categoryLarge" name="categoryLarge" required>
                        <option value="">대분류를 선택해주세요</option>
                        <!-- JS will populate this -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="categoryMid">중분류 <span class="required">*</span></label>
                    <select id="categoryMid" name="categoryMid" required disabled>
                        <option value="">먼저 대분류를 선택해주세요</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>세부 스킬</label>
                    <div class="skill-input-container">
                        <div class="skill-tag-display" onclick="focusSkillInput()">
                            <input type="text" class="skill-input" id="skillInput" placeholder="예) React, Python, Figma" autocomplete="off">
                        </div>
                        <ul class="skill-suggestions" id="skillSuggestions"></ul>
                    </div>
                    <div class="helper-text">보유한 세부 기술이나 역량을 자유롭게 입력해주세요.</div>
                </div>
            </section>

            <!-- 3. 경력 -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-briefcase"></i>
                    <span>경력</span>
                </h2>
                
                <ul class="dynamic-list" id="experienceList">
                    <!-- Experience items will be added here dynamically -->
                </ul>
                <button type="button" class="add-item-btn" onclick="addExperience()">
                    <i class="fas fa-plus"></i> 경력 추가
                </button>
            </section>

            <!-- 4. 자격증 (NEW) -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-certificate"></i>
                    <span>자격증</span>
                </h2>
                
                <ul class="dynamic-list" id="certificateList">
                    <!-- Certificate items will be added here dynamically -->
                </ul>
                <button type="button" class="add-item-btn" onclick="addCertificate()">
                    <i class="fas fa-plus"></i> 자격증 추가
                </button>
            </section>

            <!-- 5. 포트폴리오 -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-folder-open"></i>
                    <span>포트폴리오</span>
                </h2>
                
                <div class="form-group">
                    <label for="portfolioInput">파일 업로드</label>
                    <input type="file" id="portfolioInput" multiple onchange="handlePortfolioUpload(event)">
                </div>
                <ul class="dynamic-list" id="portfolioList">
                    <!-- Portfolio files will be listed here -->
                </ul>
            </section>

            <!-- 6. 시간 패키지 -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-clock"></i>
                    <span>시간 패키지</span>
                </h2>
                
                <ul class="dynamic-list" id="packageList">
                    <!-- Package items will be added here dynamically -->
                </ul>
                <button type="button" class="add-item-btn" onclick="addPackage()">
                    <i class="fas fa-plus"></i> 패키지 추가
                </button>
            </section>

            <!-- 7. 상세 소개 -->
            <section class="section">
                <h2 class="section-title">
                    <i class="fas fa-comment-dots"></i>
                    <span>상세 소개</span>
                </h2>
                
                <div class="form-group">
                    <label for="detailedIntro">자기소개</label>
                    <textarea id="detailedIntro" name="detailedIntro" placeholder="자신에 대해 자유롭게 소개해주세요. (최대 500자)"></textarea>
                </div>
            </section>
        </form>
    </div>

    <!-- Bottom Action Bar -->
    <div class="action-bar">
        <button type="submit" form="profileForm" class="save-button">프로필 저장하기</button>
    </div>

    <!-- Hidden Templates for Dynamic Lists -->
    <div id="experienceTemplate" style="display: none;">
        <div class="list-item">
            <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
            <div class="form-group">
                <label>회사/조직명</label>
                <input type="text" name="company" placeholder="예) ㈜테크솔루션">
            </div>
            <div class="form-group">
                <label>직책/역할</label>
                <input type="text" name="exp_role" placeholder="예) 수석 컨설턴트">
            </div>
            <div class="form-group">
                <label>근무 기간</label>
                <input type="text" name="duration" placeholder="예) 2018.03 - 현재">
            </div>
            <div class="form-group">
                <label>주요 성과 및 업무</label>
                <textarea name="description" placeholder="담당했던 주요 업무와 성과를 기술해주세요."></textarea>
            </div>
        </div>
    </div>

    <div id="packageTemplate" style="display: none;">
        <div class="list-item">
            <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
            <div class="form-group">
                <label>패키지명</label>
                <input type="text" name="pkg_name" placeholder="예) 주 10시간 CMO 패키지">
            </div>
            <div class="form-group">
                <label>유형</label>
                <select name="pkg_type">
                    <option value="weekly">주간</option>
                    <option value="monthly">월간</option>
                    <option value="session">회차</option>
                </select>
            </div>
            <div class="form-group">
                <label>가격</label>
                <input type="text" name="pkg_price" placeholder="예) 200만원">
            </div>
            <div class="form-group">
                <label>설명</label>
                <textarea name="pkg_description" placeholder="패키지에 포함되는 서비스를 상세히 설명해주세요."></textarea>
            </div>
        </div>
    </div>

    <!-- NEW: Hidden Template for Certificates -->
    <div id="certificateTemplate" style="display: none;">
        <div class="list-item">
            <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
            <div class="form-group">
                <label>자격증명 <span class="required">*</span></label>
                <input type="text" name="cert_name" placeholder="예) 정보보안기사" required>
            </div>
            <div class="form-group">
                <label>발급 기관</label>
                <input type="text" name="cert_issuer" placeholder="예) 한국정보통신진흥원">
            </div>
            <div class="form-group">
                <label>취득일</label>
                <input type="date" name="cert_date" required>
            </div>
            <div class="form-group">
                <label>만료일</label>
                <input type="date" name="cert_expiry_date">
                <span style="margin-left: 10px; color: var(--text-muted);">유효 여부 선택 시 비워두세요</span>
            </div>
            <div class="form-group">
                <label>상태</label>
                <select name="cert_status">
                    <option value="valid">유효</option>
                    <option value="expired">만료</option>
                </select>
            </div>
            <div class="form-group">
                <label>증빙 파일</label>
                <input type="file" name="cert_file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleCertificateUpload(event, this)">
            </div>
            <div class="form-group">
                <span class="file-name">선택된 파일 없음</span>
            </div>
        </div>
    </div>

    <script>
        // --- JavaScript Functionality ---

        // 뒤로가기 기능
        function goBack() {
            window.history.back();
        }

        // --- Expertise Category Logic (Based on V3) ---
        const expertiseCategories = {
            'A': { name: '기술/개발', options: [
                { code: 'IT01', name: '웹 개발' }, { code: 'IT02', name: '앱 개발' }, { code: 'IT03', name: 'AI/머신러닝' },
                { code: 'IT04', name: '데이터 분석' }, { code: 'IT05', name: '보안/인증' },
                { code: 'IT06', name: '클라우드/인프라' }, { code: 'IT07', name: '게임 개발' },
                { code: 'IT08', name: '블록체인/Web3' }
            ]},
            'B': { name: '디자인/크리에이티브', options: [
                { code: 'DS01', name: '영상 편집' }, { code: 'DS02', name: '모션그래픽/3D' },
                { code: 'DS03', name: '그래픽 디자인' }, { code: 'DS04', name: '일러스트/캐릭터' },
                { code: 'DS05', name: 'UI/UX 디자인' }, { code: 'DS06', name: '제품/산업 디자인' },
                { code: 'DS07', name: '사진/촬영' }, { code: 'DS08', name: '음악/사운드' }
            ]},
            'C': { name: '마케팅/홍보', options: [
                { code: 'MK01', name: '퍼포먼스 마케팅' }, { code: 'MK02', name: 'SNS 마케팅' },
                { code: 'MK03', name: '콘텐츠 마케팅' }, { code: 'MK04', name: '브랜딩/CI' },
                { code: 'MK05', name: 'PR/언론홍보' }, { code: 'MK06', name: '영업/세일즈' }
            ]},
            'D': { name: '글쓰기/번역', options: [
                { code: 'WR01', name: '카피라이팅' }, { code: 'WR02', name: '콘텐츠 글�기' },
                { code: 'WR03', name: '번역/통역' }, { code: 'WR04', name: '출판/교정' }
            ]},
            'E': { name: '비즈니스/경영', options: [
                { code: 'BZ01', name: '경영/전략 컨설팅' }, { code: 'BZ02', name: '창업/스타트업' },
                { code: 'BZ03', name: '재무/회계' }, { code: 'BZ04', name: '세무/기장' },
                { code: 'BZ05', name: '법률/계약' }, { code: 'BZ06', name: '특허/지식재산' }
            ]},
            'F': { name: 'HR/인사', options: [
                { code: 'HR01', name: '채용/헤드헌팅' }, { code: 'HR02', name: '인사제도/조직' },
                { code: 'HR03', name: '노무/급여' }, { code: 'HR04', name: '커리어 코칭' }
            ]},
            'G': { name: '교육/강의', options: [
                { code: 'ED01', name: '기업교육/강의' }, { code: 'ED02', name: '외국어 교육' },
                { code: 'ED03', name: '입시/학원' }, { code: 'ED04', name: '자격증/실무' }
            ]},
            'H': { name: '건축/설계', options: [
                { code: 'BD01', name: '건축 설계' }, { code: 'BD02', name: '토목/조경' },
                { code: 'BD03', name: '도시/부동산' }
            ]},
            'I': { name: '인테리어/시공', options: [
                { code: 'IN01', name: '인테리어 디자인' }, { code: 'IN02', name: '도배/바닥' },
                { code: 'IN03', name: '주방/욕실' }, { code: 'IN04', name: '목공/가구' }
            ]},
            'J': { name: '설비/수리', options: [
                { code: 'FC01', name: '전기/조명' }, { code: 'FC02', name: '설비/배관' },
                { code: 'FC03', name: '방수/단열' }, { code: 'FC04', name: '철거/청소' }
            ]},
            'K': { name: '스포츠/피트니스', options: [
                { code: 'SP01', name: '골프/라켓' }, { code: 'SP02', name: '피트니스/PT' },
                { code: 'SP03', name: '요가/필라테스' }, { code: 'SP04', name: '수영/아웃도어' },
                { code: 'SP05', name: '댄스/무술' }
            ]},
            'L': { name: '뷰티/패션', options: [
                { code: 'BT01', name: '메이크업/헤어' }, { code: 'BT02', name: '네일/속눈썹' },
                { code: 'BT03', name: '패션/스타일링' }
            ]},
            'M': { name: '행사/엔터테인먼트', options: [
                { code: 'EV01', name: '웨딩/돌잔치' }, { code: 'EV02', name: '행사/컨퍼런스' },
                { code: 'EV03', name: 'MC/공연' }
            ]},
            'N': { name: '생활서비스', options: [
                { code: 'LF01', name: '반려동물' }, { code: 'LF02', name: '청소/정리' },
                { code: 'LF03', name: '이사/운송' }, { code: 'LF04', name: '수리/설치' }
            ]},
            'O': { name: '전문서비스', options: [
                { code: 'PS01', name: '의료/헬스케어' }, { code: 'PS02', name: '공학/제조' },
                { code: 'PS03', name: '물류/무역' }, { code: 'PS04', name: '농업/식품' }
            ]}
        };

        const categoryLargeSelect = document.getElementById('categoryLarge');
        const categoryMidSelect = document.getElementById('categoryMid');

        // Populate major category dropdown on page load
        for (const key in expertiseCategories) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = expertiseCategories[key].name;
            categoryLargeSelect.appendChild(option);
        }

        // Event listener for major category change
        categoryLargeSelect.addEventListener('change', function() {
            const selectedKey = this.value;
            // Clear and reset mid-category dropdown
            categoryMidSelect.innerHTML = '<option value="">중분류를 선택해주세요</option>';
            categoryMidSelect.disabled = true;

            if (selectedKey && expertiseCategories[selectedKey]) {
                categoryMidSelect.disabled = false;
                const subCategories = expertiseCategories[selectedKey].options;
                subCategories.forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub.code;
                    option.textContent = sub.name;
                    categoryMidSelect.appendChild(option);
                });
            }
        });

        // --- Skill Tag Input Logic (Reused from request form) ---
        const skillInput = document.getElementById('skillInput');
        const skillSuggestions = document.getElementById('skillSuggestions');
        const skillTagDisplay = document.querySelector('.skill-tag-display');
        const allSkills = [
            'React', 'Vue.js', 'Angular', 'Node.js', 'Python', 'Java', 'Spring Boot',
            '데이터 분석', '머신러닝', '딥러닝', 'SQL', 'AWS', 'Docker', 'Kubernetes',
            'Figma', 'Adobe XD', 'Sketch', 'UI/UX 디자인', '그래픽 디자인',
            '보고서 작성', '기획', 'PM', 'Scrum', 'Agile',
            '디지털 마케팅', '퍼포먼스 마케팅', '콘텐츠 마케팅', '브랜딩', 'SNS 운영',
            'B2B 영업', 'B2C 영업', '고객 관리(CRM)', 'IR', '재무 모델링', '회계 감사',
            '채용', '인사 제도', '조직 문화', '법률 자문', '계약서 검토'
        ];
        let selectedSkills = [];
        let currentFocus = -1; // For keyboard navigation

        function focusSkillInput() {
            skillInput.focus();
        }

        function renderSelectedSkills() {
            skillTagDisplay.querySelectorAll('.tag').forEach(tag => tag.remove());
            
            selectedSkills.forEach((skill, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${skill}
                    <button type="button" onclick="removeSkill(${index})"><i class="fas fa-times"></i></button>
                `;
                skillTagDisplay.insertBefore(tagElement, skillInput);
            });
        }
        
        function addSkill(skillName) {
            if (!selectedSkills.includes(skillName)) {
                selectedSkills.push(skillName);
                renderSelectedSkills();
            }
            skillInput.value = '';
            hideSuggestions();
        }

        function removeSkill(index) {
            selectedSkills.splice(index, 1);
            renderSelectedSkills();
        }

        function showSuggestions(skills) {
            skillSuggestions.innerHTML = '';
            if (skills.length === 0) {
                hideSuggestions();
                return;
            }
            skills.forEach((skill, index) => {
                const item = document.createElement('li');
                item.textContent = skill;
                item.className = 'skill-suggestion-item';
                item.addEventListener('click', () => {
                    addSkill(skill);
                });
                skillSuggestions.appendChild(item);
            });
            skillSuggestions.classList.add('active');
        }

        function hideSuggestions() {
            skillSuggestions.classList.remove('active');
            currentFocus = -1;
        }
        
        function filterSkills(query) {
            if (!query) {
                showSuggestions(allSkills.slice(0, 10));
                return;
            }
            const filtered = allSkills.filter(skill => 
                skill.toLowerCase().includes(query.toLowerCase())
            );
            showSuggestions(filtered);
        }

        skillInput.addEventListener('input', () => filterSkills(skillInput.value));
        skillInput.addEventListener('focus', () => filterSkills(skillInput.value));
        
        skillInput.addEventListener('keydown', (e) => {
            const items = skillSuggestions.getElementsByClassName('skill-suggestion-item');
            if (e.key === 'ArrowDown') {
                currentFocus++;
                if (currentFocus >= items.length) currentFocus = 0;
                addActive(items);
            } else if (e.key === 'ArrowUp') {
                currentFocus--;
                if (currentFocus < 0) currentFocus = (items.length - 1);
                addActive(items);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (currentFocus > -1 && items[currentFocus]) {
                    addSkill(items[currentFocus].textContent);
                } else if (skillInput.value) {
                    addSkill(skillInput.value);
                }
            } else if (e.key === 'Escape') {
                hideSuggestions();
            }
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.skill-input-container')) {
                hideSuggestions();
            }
        });

        function addActive(items) {
            if (!items) return;
            removeActive(items);
            if (currentFocus >= 0 && currentFocus < items.length) {
                items[currentFocus].classList.add('active');
            }
        }

        function removeActive(items) {
            for (let i = 0; i < items.length; i++) {
                items[i].classList.remove('active');
            }
        }


        // --- Dynamic List Management (Experience, Packages, Certificates) ---
        function addExperience() {
            const list = document.getElementById('experienceList');
            const template = document.getElementById('experienceTemplate');
            const newItem = template.content.cloneNode(true).querySelector('.list-item');
            list.appendChild(newItem);
        }

        function addPackage() {
            const list = document.getElementById('packageList');
            const template = document.getElementById('packageTemplate');
            const newItem = template.content.cloneNode(true).querySelector('.list-item');
            list.appendChild(newItem);
        }

        // --- NEW: Certificate Management ---
        function addCertificate() {
            const list = document.getElementById('certificateList');
            const template = document.getElementById('certificateTemplate');
            const newItem = template.content.cloneNode(true).querySelector('.list-item');
            list.appendChild(newItem);
        }

        // --- Portfolio Upload ---
        function handlePortfolioUpload(event) {
            const files = event.target.files;
            const list = document.getElementById('portfolioList');
            
            for (const file of files) {
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.innerHTML = `
                    <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
                    <div class="form-group">
                        <label>파일명</label>
                        <input type="text" value="${file.name}" readonly>
                    </div>
                `;
                list.appendChild(listItem);
            }
        }

        // --- NEW: Certificate File Upload ---
        function handleCertificateUpload(event, listItemElement) {
            const file = event.target.files[0];
            if (file) {
                const fileNameDisplay = listItemElement.querySelector('.file-name');
                if (fileNameDisplay) {
                    fileNameDisplay.textContent = file.name;
                }
            }
        }

        // --- Profile Picture Preview ---
        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatarPreview').src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        // --- Form Submission ---
        document.getElementById('profileForm').addEventListener('submit', function(event) {
            event.preventDefault();

            // In a real application, you would gather all data from the form,
            // including from dynamic lists, and send it to a server.
            // For this mockup, we'll just show an alert.
            
            alert('프로필이 성공적으로 저장되었습니다!');
            // window.location.href = '/my-profile'; // Redirect after save
        });

        // --- Initial Load: Add one empty experience, package, and certificate by default ---
        document.addEventListener('DOMContentLoaded', () => {
            addExperience();
            addPackage();
            addCertificate();
        });

    </script>

</body>
</html>